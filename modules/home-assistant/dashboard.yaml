title: Fleming Place

# ==================== BUTTON-CARD TEMPLATES ====================
button_card_templates:
  # Base transparent card (no background, shadow, or border)
  transparent:
    styles:
      card:
        - background: transparent
        - box-shadow: none
        - border: none
        - border-radius: 0

  # Page header title
  page_header:
    template: transparent
    show_icon: false
    show_state: false
    styles:
      card:
        - padding: 20px 16px 12px 16px
      name:
        - font-family: "'Helvetica Neue', Helvetica, Arial, sans-serif"
        - font-size: 30px
        - font-weight: 500
        - color: "#E85D04"
        - justify-self: start
        - text-align: left
        - width: 100%
        - letter-spacing: -0.5px

  # Info line styling (weather, calendar, etc.)
  info_lines:
    template: transparent
    show_name: false
    show_state: false
    show_icon: false
    styles:
      card:
        - padding: 8px 16px 16px 16px
        - margin-top: 0px
      grid:
        - grid-template-columns: 1fr
        - gap: 6px

  # Tab button base styling
  tab_button:
    template: transparent
    show_icon: false
    show_state: false
    styles:
      card:
        - padding: 8px 0
      name:
        - font-size: 15px

  # Active tab button
  tab_button_active:
    template: tab_button
    styles:
      name:
        - font-weight: 500
        - color: "#E85D04"
        - border-bottom: 2px solid #E85D04
        - padding-bottom: 6px

  # Inactive tab button
  tab_button_inactive:
    template: tab_button
    styles:
      name:
        - color: var(--secondary-text-color)

  # Room card template for rooms tab
  # Variables: room_name, room_icon, light_entity, motion_entity, media_entity
  room_card:
    show_icon: false
    show_name: false
    show_state: false
    card_mod:
      style: |
        ha-card {
          background: #ffffff !important;
          border-radius: 50px !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12) !important;
          border: none !important;
        }
        :host-context(html.darkmode) ha-card,
        :host-context(html[data-theme="dark"]) ha-card {
          background: #1c1c1e !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
    styles:
      card:
        - padding: 0 20px 0 0
        - margin-bottom: 12px
        - height: 80px
      grid:
        - grid-template-areas: '"room_image room_info device_icons"'
        - grid-template-columns: 80px 1fr auto
        - grid-template-rows: 1fr
        - align-items: center
      custom_fields:
        room_image:
          - justify-self: start
          - align-self: center
        room_info:
          - justify-self: start
          - align-self: center
          - padding-left: 16px
          - text-align: left
        device_icons:
          - justify-self: end
          - align-self: center
    custom_fields:
      room_image: |
        [[[
          const image = variables.room_image || '';
          const icon = variables.room_icon || 'mdi:home';

          if (image) {
            return `<div style="
              width: 80px;
              height: 80px;
              border-radius: 50%;
              overflow: hidden;
              box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            ">
              <img src="${image}" style="
                width: 100%;
                height: 100%;
                object-fit: cover;
              " />
            </div>`;
          } else {
            return `<div style="
              width: 80px;
              height: 80px;
              border-radius: 50%;
              background: linear-gradient(180deg, #e8e4e0 0%, #d4cfc9 100%);
              display: flex;
              align-items: center;
              justify-content: center;
              overflow: hidden;
            ">
              <ha-icon icon="${icon}" style="
                --mdc-icon-size: 36px;
                color: #8a8178;
              "></ha-icon>
            </div>`;
          }
        ]]]
      room_info: |
        [[[
          const roomName = variables.room_name || 'Room';
          const motionEntity = variables.motion_entity;

          let statusText = 'No motion sensor';
          let statusColor = 'var(--secondary-text-color)';

          if (motionEntity && states[motionEntity]) {
            const motionState = states[motionEntity];
            if (motionState.state === 'unavailable') {
              statusText = 'Sensor unavailable';
            } else if (motionState.state === 'on') {
              statusText = 'Motion detected';
              statusColor = '#4CAF50';
            } else {
              const lastChanged = new Date(motionState.last_changed);
              const now = new Date();
              const diffMs = now - lastChanged;
              const diffSecs = Math.floor(diffMs / 1000);
              const diffMins = Math.floor(diffSecs / 60);
              const diffHours = Math.floor(diffMins / 60);
              const diffDays = Math.floor(diffHours / 24);

              if (diffDays > 0) {
                statusText = 'Clear - ' + diffDays + 'd ago';
              } else if (diffHours > 0) {
                statusText = 'Clear - ' + diffHours + 'h ago';
              } else if (diffMins > 0) {
                statusText = 'Clear - ' + diffMins + 'm ago';
              } else {
                statusText = 'Clear - ' + diffSecs + 's ago';
              }
            }
          }

          return `<div style="display: flex; flex-direction: column; align-items: flex-start;">
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 16px;
              font-weight: 600;
              color: var(--primary-text-color);
              line-height: 1.3;
              text-align: left;
            ">${roomName}</span>
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 13px;
              color: ${statusColor};
              line-height: 1.4;
              text-align: left;
            ">${statusText}</span>
          </div>`;
        ]]]
      device_icons: |
        [[[
          const lightEntity = variables.light_entity;
          const mediaEntity = variables.media_entity;

          let lightOn = false;
          let mediaOn = false;
          let hasLight = !!lightEntity;
          let hasMedia = !!mediaEntity;

          if (lightEntity && states[lightEntity]) {
            lightOn = states[lightEntity].state === 'on';
          }
          if (mediaEntity && states[mediaEntity]) {
            const mediaState = states[mediaEntity].state;
            mediaOn = mediaState === 'playing' || mediaState === 'on';
          }

          const lightColor = lightOn ? '#1a1a1a' : '#d1d1d1';
          const mediaColor = mediaOn ? '#1a1a1a' : '#d1d1d1';

          let icons = '';

          if (hasMedia) {
            icons += `<ha-icon icon="mdi:television" style="
              --mdc-icon-size: 28px;
              color: ${mediaColor};
              margin-right: 16px;
            "></ha-icon>`;
          }

          if (hasLight) {
            icons += `<ha-icon icon="mdi:lightbulb" style="
              --mdc-icon-size: 28px;
              color: ${lightColor};
            "></ha-icon>`;
          }

          return `<div style="display: flex; align-items: center;">${icons}</div>`;
        ]]]
    tap_action:
      action: more-info
      entity: '[[[ return variables.light_entity; ]]]'

  # Person card template for peoples tab
  # Variables: person_name, person_entity, battery_entity
  person_card:
    show_icon: false
    show_name: false
    show_state: false
    card_mod:
      style: |
        ha-card {
          background: #ffffff !important;
          border-radius: 50px !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12) !important;
          border: none !important;
        }
        :host-context(html.darkmode) ha-card,
        :host-context(html[data-theme="dark"]) ha-card {
          background: #1c1c1e !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
        }
    styles:
      card:
        - padding: 0 20px 0 0
        - margin-bottom: 12px
        - height: 80px
      grid:
        - grid-template-areas: '"person_image person_info battery_info"'
        - grid-template-columns: 80px 1fr auto
        - grid-template-rows: 1fr
        - align-items: center
      custom_fields:
        person_image:
          - justify-self: start
          - align-self: center
        person_info:
          - justify-self: start
          - align-self: center
          - padding-left: 16px
          - text-align: left
        battery_info:
          - justify-self: end
          - align-self: center
    custom_fields:
      person_image: |
        [[[
          const personEntity = variables.person_entity;
          let imageUrl = '';

          if (personEntity && states[personEntity] && states[personEntity].attributes.entity_picture) {
            imageUrl = states[personEntity].attributes.entity_picture;
          }

          if (imageUrl) {
            return `<div style="
              width: 80px;
              height: 80px;
              border-radius: 50%;
              overflow: hidden;
              box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            ">
              <img src="${imageUrl}" style="
                width: 100%;
                height: 100%;
                object-fit: cover;
              " />
            </div>`;
          } else {
            return `<div style="
              width: 80px;
              height: 80px;
              border-radius: 50%;
              background: linear-gradient(180deg, #e8e4e0 0%, #d4cfc9 100%);
              display: flex;
              align-items: center;
              justify-content: center;
              overflow: hidden;
            ">
              <ha-icon icon="mdi:account" style="
                --mdc-icon-size: 36px;
                color: #8a8178;
              "></ha-icon>
            </div>`;
          }
        ]]]
      person_info: |
        [[[
          const personName = variables.person_name || 'Person';
          const personEntity = variables.person_entity;

          let locationText = 'Unknown';
          let locationColor = 'var(--secondary-text-color)';

          if (personEntity && states[personEntity]) {
            const state = states[personEntity].state;
            if (state === 'home') {
              locationText = 'Home';
              locationColor = '#4CAF50';
            } else if (state === 'not_home') {
              locationText = 'Away';
            } else {
              // It's a zone name
              locationText = state.split('_').map(word =>
                word.charAt(0).toUpperCase() + word.slice(1)
              ).join(' ');
            }
          }

          return `<div style="display: flex; flex-direction: column; align-items: flex-start;">
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 16px;
              font-weight: 600;
              color: var(--primary-text-color);
              line-height: 1.3;
              text-align: left;
            ">${personName}</span>
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 13px;
              color: ${locationColor};
              line-height: 1.4;
              text-align: left;
            ">${locationText}</span>
          </div>`;
        ]]]
      battery_info: |
        [[[
          const batteryEntity = variables.battery_entity;

          if (!batteryEntity || !states[batteryEntity]) {
            return '';
          }

          const batteryLevel = states[batteryEntity].state;
          const batteryNum = parseInt(batteryLevel);
          let batteryColor = '#d1d1d1';

          if (!isNaN(batteryNum)) {
            if (batteryNum <= 20) {
              batteryColor = '#f44336';
            } else if (batteryNum <= 50) {
              batteryColor = '#ff9800';
            } else {
              batteryColor = '#d1d1d1';
            }
          }

          return `<span style="
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 13px;
            color: ${batteryColor};
          ">Battery: ${batteryLevel}%</span>`;
        ]]]
    tap_action:
      action: more-info
      entity: '[[[ return variables.person_entity; ]]]'

# ==================== VIEWS ====================
views:
  - !include /var/lib/hass/views/home.yaml
