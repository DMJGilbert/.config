title: Fleming Place

# ==================== BUTTON-CARD TEMPLATES ====================
button_card_templates:
  # Base transparent card (no background, shadow, or border)
  transparent:
    styles:
      card:
        - background: transparent
        - box-shadow: none
        - border: none
        - border-radius: 0

  # Page header title
  page_header:
    template: transparent
    show_icon: false
    show_state: false
    styles:
      card:
        - padding: 20px 16px 12px 16px
      name:
        - font-family: "'Helvetica Neue', Helvetica, Arial, sans-serif"
        - font-size: 30px
        - font-weight: 500
        - color: "#E85D04"
        - justify-self: start
        - text-align: left
        - width: 100%
        - letter-spacing: -0.5px

  # Info line styling (weather, calendar, etc.)
  info_lines:
    template: transparent
    show_name: false
    show_state: false
    show_icon: false
    styles:
      card:
        - padding: 8px 16px 16px 16px
        - margin-top: 0px
      grid:
        - grid-template-columns: 1fr
        - gap: 6px

  # Tab button base styling
  tab_button:
    template: transparent
    show_icon: false
    show_state: false
    styles:
      card:
        - padding: 8px 0
      name:
        - font-size: 15px

  # Active tab button
  tab_button_active:
    template: tab_button
    styles:
      name:
        - font-weight: 500
        - color: "#E85D04"
        - border-bottom: 2px solid #E85D04
        - padding-bottom: 6px

  # Inactive tab button
  tab_button_inactive:
    template: tab_button
    styles:
      name:
        - color: var(--secondary-text-color)

  # Room card template for rooms tab
  # Variables: room_name, room_icon, light_entity, motion_entity, media_entity
  room_card:
    show_icon: false
    show_name: false
    show_state: false
    styles:
      card:
        - background: var(--card-background-color, #fff)
        - border-radius: 16px
        - box-shadow: 0 2px 8px rgba(0,0,0,0.08)
        - padding: 12px 16px
        - margin-bottom: 8px
      grid:
        - grid-template-areas: '"room_icon room_info device_icons"'
        - grid-template-columns: 56px 1fr auto
        - grid-template-rows: 1fr
        - align-items: center
      custom_fields:
        room_icon:
          - justify-self: start
          - align-self: center
        room_info:
          - justify-self: start
          - align-self: center
          - padding-left: 12px
        device_icons:
          - justify-self: end
          - align-self: center
    custom_fields:
      room_icon: |
        [[[
          const icon = variables.room_icon || 'mdi:home';
          return `<div style="
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(232, 93, 4, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            <ha-icon icon="${icon}" style="
              --mdc-icon-size: 28px;
              color: #E85D04;
            "></ha-icon>
          </div>`;
        ]]]
      room_info: |
        [[[
          const roomName = variables.room_name || 'Room';
          const motionEntity = variables.motion_entity;

          let statusText = 'No motion sensor';
          let statusColor = 'var(--secondary-text-color)';

          if (motionEntity && states[motionEntity]) {
            const motionState = states[motionEntity];
            if (motionState.state === 'unavailable') {
              statusText = 'Sensor unavailable';
            } else if (motionState.state === 'on') {
              statusText = 'Motion detected';
              statusColor = '#4CAF50';
            } else {
              const lastChanged = new Date(motionState.last_changed);
              const now = new Date();
              const diffMs = now - lastChanged;
              const diffSecs = Math.floor(diffMs / 1000);
              const diffMins = Math.floor(diffSecs / 60);
              const diffHours = Math.floor(diffMins / 60);
              const diffDays = Math.floor(diffHours / 24);

              if (diffDays > 0) {
                statusText = 'Clear - ' + diffDays + 'd ago';
              } else if (diffHours > 0) {
                statusText = 'Clear - ' + diffHours + 'h ago';
              } else if (diffMins > 0) {
                statusText = 'Clear - ' + diffMins + 'm ago';
              } else {
                statusText = 'Clear - ' + diffSecs + 's ago';
              }
            }
          }

          return `<div style="display: flex; flex-direction: column;">
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 16px;
              font-weight: 600;
              color: var(--primary-text-color);
              line-height: 1.3;
            ">${roomName}</span>
            <span style="
              font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
              font-size: 13px;
              color: ${statusColor};
              line-height: 1.4;
            ">${statusText}</span>
          </div>`;
        ]]]
      device_icons: |
        [[[
          const lightEntity = variables.light_entity;
          const mediaEntity = variables.media_entity;

          let lightOn = false;
          let mediaOn = false;
          let hasLight = !!lightEntity;
          let hasMedia = !!mediaEntity;

          if (lightEntity && states[lightEntity]) {
            lightOn = states[lightEntity].state === 'on';
          }
          if (mediaEntity && states[mediaEntity]) {
            const mediaState = states[mediaEntity].state;
            mediaOn = mediaState === 'playing' || mediaState === 'on';
          }

          const lightColor = lightOn ? '#FFA500' : 'var(--disabled-text-color)';
          const lightOpacity = lightOn ? '1' : '0.35';
          const mediaColor = mediaOn ? '#4A9EFF' : 'var(--disabled-text-color)';
          const mediaOpacity = mediaOn ? '1' : '0.35';

          let icons = '';

          if (hasLight) {
            icons += `<ha-icon icon="mdi:lightbulb" style="
              --mdc-icon-size: 24px;
              color: ${lightColor};
              opacity: ${lightOpacity};
              margin-right: 8px;
            "></ha-icon>`;
          }

          if (hasMedia) {
            icons += `<ha-icon icon="mdi:television" style="
              --mdc-icon-size: 24px;
              color: ${mediaColor};
              opacity: ${mediaOpacity};
            "></ha-icon>`;
          }

          return `<div style="display: flex; align-items: center;">${icons}</div>`;
        ]]]
    tap_action:
      action: more-info
      entity: '[[[ return variables.light_entity; ]]]'

# ==================== VIEWS ====================
views:
  - !include /var/lib/hass/views/home.yaml
